# –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Cloud Templates Ubuntu 20.04 –≤ Proxmox (SDN-ready)

–ù–∞–±–æ—Ä bash-—Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è **–≥–æ—Ç–æ–≤—ã—Ö –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é cloud-init —à–∞–±–ª–æ–Ω–æ–≤ (template) Ubuntu 20.04** –≤ **Proxmox VE**. –®–∞–±–ª–æ–Ω—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è **–º–∞—Å—Å–æ–≤–æ–≥–æ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**, **SDN-—Å–µ—Ç–µ–π** –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

## üìÅ –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

| –°–∫—Ä–∏–ø—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
| :--- | :--- | :--- |
| **`ubuntu2004-template.sh`** | –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ —à–∞–±–ª–æ–Ω–∞ | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑, SDN-friendly, —á–∏—Å—Ç—ã–π cloud-init |
| **`ubuntu2004-template-auto.sh`** | –°–æ–∑–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–æ–≥–æ —à–∞–±–ª–æ–Ω–∞ —Å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–æ–π | **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤**, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ |

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* ‚úÖ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π **Ubuntu 20.04 cloud image (disk-kvm)**
* ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è **Proxmox / QEMU**
* ‚úÖ **SDN-friendly** (bridge –∑–∞–¥–∞—ë—Ç—Å—è –ø—Ä–∏ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏)
* ‚úÖ Cloud-init (DHCP, hostname, SSH keys)
* ‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è **–º–∞—Å—Å–æ–≤–æ–≥–æ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**
* ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º —Å **Proxmox VE 7 / 8**
* ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π** (—Ç–æ–ª—å–∫–æ –≤ `-auto` –≤–µ—Ä—Å–∏–∏)

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

* Proxmox VE 7 –∏–ª–∏ 8
* Storage `local-lvm` (–∏–ª–∏ –¥—Ä—É–≥–æ–µ, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–µ–µ –¥–∏—Å–∫–∏ VM)
* –î–æ—Å—Ç—É–ø –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ cloud image –∏ –ø–∞–∫–µ—Ç–æ–≤
* –ó–∞–ø—É—Å–∫ –æ—Ç `root`
* **–¢–æ–ª—å–∫–æ –¥–ª—è `-auto` —Å–∫—Ä–∏–ø—Ç–∞**: –†–∞–±–æ—á–∏–π —Å–µ—Ç–µ–≤–æ–π –º–æ—Å—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `vmbr0`) –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ VM –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –Ω–∞ —ç—Ç–∞–ø–µ —Å–±–æ—Ä–∫–∏

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (–µ—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç —É–∂–µ —Å–∫–∞—á–∞–Ω)
```bash
# –ë–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω
./ubuntu2004-template.sh <TEMPLATE_VMID> <RAM_MB> <DISK_GB> <CORES>

# –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω —Å –ø–∞–∫–µ—Ç–∞–º–∏
./ubuntu2004-template-auto.sh <TEMPLATE_VMID> <RAM_MB> <DISK_GB> <CORES>
```

**–ü—Ä–∏–º–µ—Ä—ã:**
```bash
./ubuntu2004-template.sh 9000 512 8 1
./ubuntu2004-template-auto.sh 9100 1024 20 2
```

### –ü—Ä—è–º–æ–π –∑–∞–ø—É—Å–∫ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (–±–µ–∑ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è)
```bash
# –ë–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω
bash -c "$(curl -fsSL https://raw.githubusercontent.com/pbolkhovitin/proxmox_scripts/main/vm/ubuntu2004-template.sh)" -- <VMID> <RAM_MB> <DISK_GB> <CORES>

# –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω —Å –ø–∞–∫–µ—Ç–∞–º–∏
bash -c "$(curl -fsSL https://raw.githubusercontent.com/pbolkhovitin/proxmox_scripts/main/vm/ubuntu2004-template-auto.sh)" -- <VMID> <RAM_MB> <DISK_GB> <CORES>
```

**–ü—Ä–∏–º–µ—Ä—ã:**
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ —à–∞–±–ª–æ–Ω–∞ VMID 9000 —Å 512MB RAM, 4GB –¥–∏—Å–∫–∞, 1 —è–¥—Ä–æ
bash -c "$(curl -fsSL https://raw.githubusercontent.com/pbolkhovitin/proxmox_scripts/main/vm/ubuntu2004-template.sh)" -- 9000 512 4 1

# –°–æ–∑–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–æ–≥–æ —à–∞–±–ª–æ–Ω–∞ VMID 9100 —Å 1GB RAM, 10GB –¥–∏—Å–∫–∞, 2 —è–¥—Ä–∞
bash -c "$(curl -fsSL https://raw.githubusercontent.com/pbolkhovitin/proxmox_scripts/main/vm/ubuntu2004-template-auto.sh)" -- 9100 1024 10 2
```

> **–ß—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç `-auto` —Å–∫—Ä–∏–ø—Ç?**
> –ü–æ–º–∏–º–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞–±–æ—Ä –ø–∞–∫–µ—Ç–æ–≤ –¥–ª—è —Å–µ—Ç–µ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏: `ipcalc iproute2 netplan.io net-tools iperf3 iptables iputils-ping nmap procps tcpdump traceroute systemd telnet dnsutils isc-dhcp-server apache2 qemu-guest-agent`. –°–ø–∏—Å–æ–∫ –º–æ–∂–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –∫–æ–¥–µ —Å–∫—Ä–∏–ø—Ç–∞.

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ VM –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±—É–¥–µ—Ç –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –≤ **template**.

## üß± –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç `ubuntu2004-template-auto.sh`

1.  –ó–∞–≥—Ä—É–∂–∞–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π Ubuntu 20.04 cloud image.
2.  –°–æ–∑–¥–∞—ë—Ç VM —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º —Å–µ—Ç–µ–≤—ã–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.
3.  –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –¥–∏—Å–∫ –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç cloud-init.
4.  **–ó–∞–ø—É—Å–∫–∞–µ—Ç VM –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤–Ω—É—Ç—Ä–∏ –Ω–µ—ë:**
    *   –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–∞–∫–µ—Ç–æ–≤ (`apt update`).
    *   –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã (`apt upgrade`).
    *   **–ü—Ä–æ–≤–µ—Ä–∫—É –∏ —É—Å—Ç–∞–Ω–æ–≤–∫—É –≤—Å–µ—Ö –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –ø–∞–∫–µ—Ç–æ–≤** –∏–∑ –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞.
    *   –û—á–∏—Å—Ç–∫—É –∫—ç—à–∞ apt –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–±—Ä–∞–∑–∞.
5.  –í—ã–∫–ª—é—á–∞–µ—Ç VM, –æ—á–∏—â–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–∞—Ä–æ–ª—å, –∫–ª—é—á) –∏ –æ—Ç—Å–æ–µ–¥–∏–Ω—è–µ—Ç —Å–µ—Ç–µ–≤–æ–π –º–æ—Å—Ç.
6.  –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç VM –≤ –≥–æ—Ç–æ–≤—ã–π –∫ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é **template**.

> ‚ö†Ô∏è –°–æ–∑–¥–∞–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã (template) **–Ω–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã –¥–ª—è –ø—Ä—è–º–æ–≥–æ –∑–∞–ø—É—Å–∫–∞**. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `qm clone`.

## üåê –†–∞–±–æ—Ç–∞ —Å —Å–µ—Ç—å—é (SDN)

–í —Ñ–∏–Ω–∞–ª—å–Ω–æ–º —à–∞–±–ª–æ–Ω–µ **–Ω–µ –∑–∞–¥–∞–Ω bridge**, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≥–∏–±–∫–æ—Å—Ç—å:

```bash
--net0 virtio
```

–°–µ—Ç—å —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è **–ø—Ä–∏ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏**, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SDN (VXLAN/EVPN), –æ–±—ã—á–Ω—ã–µ bridge –∏–ª–∏ VLAN.

**–ü—Ä–∏–º–µ—Ä –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è SDN:**
```bash
qm clone 9100 101 --name my-vm
qm set 101 --net0 virtio,bridge=vmbr-sdn-prod
qm start 101
```

## üîê Cloud-init –∏ –¥–æ—Å—Ç—É–ø

*   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `ubuntu`.
*   –ü–∞—Ä–æ–ª—å –Ω–µ –∑–∞–¥–∞—ë—Ç—Å—è (–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–∏ —Å–±–æ—Ä–∫–µ `-auto` —Å–∫—Ä–∏–ø—Ç–æ–º, —É–¥–∞–ª—è–µ—Ç—Å—è).
*   –î–ª—è –¥–æ—Å—Ç—É–ø–∞ **–Ω–∞—Å—Ç—Ä–æ–π—Ç–µ SSH-–∫–ª—é—á –ø—Ä–∏ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏:**
    ```bash
    qm set <VMID> --sshkey ~/.ssh/id_rsa.pub
    ```

## üß† –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–°–∫—Ä–∏–ø—Ç—ã –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã –¥–ª—è:
*   **`ubuntu2004-template.sh`**: –ë—ã—Å—Ç—Ä–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —á–∏—Å—Ç—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤ –¥–ª—è CI/CD, Dev/Test, –∫–æ–≥–¥–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–∞–∫–µ—Ç—ã —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ.
*   **`ubuntu2004-template-auto.sh`**: –°–æ–∑–¥–∞–Ω–∏—è **¬´–∑–æ–ª–æ—Ç—ã—Ö –æ–±—Ä–∞–∑–æ–≤¬ª (Golden Image)** —Å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º –ü–û –¥–ª—è Kubernetes –Ω–æ–¥, —Å–µ—Ç–µ–≤—ã—Ö —à–ª—é–∑–æ–≤, –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–≤ –∏–ª–∏ –º–∞—Å—Å–æ–≤–æ–≥–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –æ–¥–Ω–æ—Ç–∏–ø–Ω—ã—Ö –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω.

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT / Public Domain ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ.
